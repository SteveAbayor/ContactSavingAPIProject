@model IEnumerable<ContactSavingWebAPI.Contacts>

    @{
         Layout = null;
    }
    
    <!DOCTYPE html>
    <html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <link href="Content/bootstrap.min.css" rel="stylesheet" />
    </head>
    <body style="padding-top:20px">
        <div class="col-md-10 col-md-offset-1">
            <div class="well">
                <table class="table table-bordered" id="tblContact">
                    <thead>
                        <tr class="success">
                            <td colspan="2">
                                <u>Edit Contact</u>

                                <a class="btn btn-success pull-right" href="Contact.html">Return to get contact list</a>
                            </td>
                        </tr>
                        <tr>
                            <th style="width:100px">First Name</th>
                            <th style="width:150px">LastName</th>
                            <th style="width:150px">Gender</th>
                            <th style="width:150px">Phone Number</th>
                            <th style="width:40px"></th>
                        </tr>
                        
                        @foreach (Contact contact in Model)
                        {
                        <tr>
                            <td class="FirstName">
                                <span>@contact.FirstName</span>
                            </td>
                            <td class="LastName">
                                <span>@contact.LastName</span>
                            </td>
                            <td class="Gender">
                                <span>@contact.Gender</span>
                            </td>
                            <td class="PhoneNumber">
                                <span>@contact.PhoneNumber</span>
                            </td>
                            <td>
                                <a class="Delete" href="javascript:;">Delete</a>
                            </td>
                        </tr>
                        }

                    </thead>
                    <tbody>
                        <!--<tr>
                            <td>First Name</td>
                            <td>
                                <input type="text" id="txtFirstName" placeholder="First Name" />
                            </td>
                        </tr>
                        <tr>
                            <td>Last Name</td>
                            <td>
                                <input type="text" id="txtLastName" placeholder="Last Name" />
                            </td>
                        </tr>
                        <tr>
                            <td>Gender</td>
                            <td>
                                <input type="text" id="txtGender" placeholder="Gender" />
                            </td>
                        </tr>
                        <tr>
                            <td>Phone Number</td>
                            <td>
                                <input type="text" id="txtPhoneNumber" placeholder="Phone Number" />
                            </td>
                        </tr>-->
                        <tr class="success">
                            <td colspan="2">
                                <input id="btnAdd" class="btn btn-success" type="button" value="Add" />
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn btn-default" onclick="productGet(this);" type="button" data-id="1">
                    <span class="glyphicon glyphicon-edit"></span>
                </button>
                <div class="modal fade" tabindex="-1" id="successModal" data-keyboard="false" data-backdrop="static">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">
                                    &times;
                                </button>
                                <h4>Success</h4>
                            </div>
                            <div class="modal-body">
                                <h2>The contact is edited successfully!</h2>
                            </div>
                            <div class="modal-footer">
                                <button type="button" data-dismiss="modal" class="btn btn-success">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="divError" class="alert alert-danger collapse">
                    <a id="linkClose" class="close" href="#">&times;</a>
                    <div id="divErrorText"></div>
                </div>
            </div>
        </div>

        <script src="Scripts/jquery-1.10.2.min.js"></script>
        <script src="Scripts/bootstrap.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                if ($('tblContact tr').length > 2) {
                    $('tblContact tr:eq(1)').remove();
                } else {
                    var row = $('tblContact tr:last-child');
                    row.find('.Delete').hide();
                    row.find('span').html('&nbsp;')
                }

                function AppendRow(row, firstName, lastName, gender, phoneNumber) {
                    //Bind First Name
                    $('.FirstName', row).find('span').html(firstName);
                    $('.FirstName', row).find('input').val(firstName);

                    //Bind Last Name
                    $('.LastName', row).find('span').html(lastName);
                    $('.LastName', row).find('input').val(lastName);

                    //Bind Gender
                    $('.Gender', row).find('span').html(gender);
                    $('.Gender', row).find('input').val(gender);

                    //Bind Phone Number
                    $('.PhoneNumber', row).find('span').html(phoneNumber);
                    $('.PhoneNumber', row).find('input').val(phoneNumber);

                    row.find('.Delete').show();
                    $('#tblContact').append(row);
                };

                //Add event handler
                $("body").on("click", "#btnAdd", function () {
                    var txtFirstName = $("#txtFirstName");
                    var txtLastName = $("#txtLastName");
                    var txtGender = $("#txtGender");
                    var txtPhoneNumber = $("#txtPhoneNumber");
                    $.ajax({
                        type: "POST",
                        url: "/api/Contacts",
                        data: '{firstName: "' + txtFirstName.val() + '", lastName: "' + txtLastName.val() + '", gender: "' + txtGender.val() + '" PhoneNumber: "' + txtPhoneNumber.val() + '" }',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (r) {
                            var row = $("#tblContact tr:last-child");
                            if ($("#tblContact tr:last-child span").eq(0).html() != "&nbsp;") {
                                row = row.clone();
                            }
                            AppendRow(row, r.FirstName, r.LastName, r.Gender, r.PhoneNumber);
                            txtFirstName.val("");
                            txtLastName.val("");
                            txtGender.val("");
                            txtPhoneNumber.val("");
                        }
                    });
                });

                //Delete event handler.
                $("body").on("click", "#tblContact .Delete", function () {
                    if (confirm("Do you want to delete this row?")) {
                        var row = $(this).closest("tr");
                        var contactId = row.find("span").html();
                        $.ajax({
                            type: "POST",
                            url: "/api/Contact",
                            data: '{contactId: ' + contactId + '}',
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (response) {
                                if ($("#tblContact tr").length > 2) {
                                    row.remove();
                                } else {
                                    row.find(".Delete").hide();
                                    row.find("span").html('&nbsp;');
                                }
                            }
                        });
                    }
                });

                var Contact = {
                    FirstName: "",
                    LastName: "",
                    Gender: "",
                    PhoneNumber: ""
                };

                var btnEdit = $('#btnEdit');

                $('#linkClose').click(function () {
                    $('#divError').hide('fade');
                });
                $('#btnRegister').click(function () {
                    $.ajax({
                        url: '/api/Contacts/register',
                        method: 'POST',
                        data: {
                            FirstName: $('#txtFirstName').val(),
                            LastName: $('#txtLastName').val(),
                            Gender: $('#txtGender').val(),
                            PhoneNumber: $('#txtPhoneNumber').val()
                        },
                        success: function () {
                            $('#successModal').modal('show');
                        },
                        error: function (jqXHR) {
                            $('#divErrorText').text(jqXHR.responseText);
                            $('#divError').show('fade');
                        },
                    });
                });
            });
        </script>

    </body>
</html>
